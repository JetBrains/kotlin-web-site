<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2025-06-25T13:01:24.818244197"><meta name="build-number" content="637"><script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&amp;l=' + l : '';
        j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-5P98');
</script>
<script src="https://resources.jetbrains.com/storage/help-app/v6/analytics.js"></script>
<title>Android source set layout | Kotlin Multiplatform Documentation</title><script type="application/json" id="virtual-toc-data">[{"id":"check-the-compatibility","level":0,"title":"Check the compatibility","anchor":"#check-the-compatibility"},{"id":"rename-kotlin-source-sets","level":0,"title":"Rename Kotlin source sets","anchor":"#rename-kotlin-source-sets"},{"id":"move-source-files","level":0,"title":"Move source files","anchor":"#move-source-files"},{"id":"move-the-androidmanifest-xml-file","level":0,"title":"Move the AndroidManifest.xml file","anchor":"#move-the-androidmanifest-xml-file"},{"id":"check-the-relationship-between-android-and-common-tests","level":0,"title":"Check the relationship between Android and common tests","anchor":"#check-the-relationship-between-android-and-common-tests"},{"id":"adjust-the-implementation-of-android-flavors","level":0,"title":"Adjust the implementation of Android flavors","anchor":"#adjust-the-implementation-of-android-flavors"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b454/app.css" rel="stylesheet"><link rel="manifest" href="https://www.jetbrains.com/site.webmanifest"><link rel="icon" type="image/x-icon" sizes="16x16" href="https://resources.jetbrains.com/storage/ui/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="https://resources.jetbrains.com/storage/ui/favicons/apple-touch-icon-57x57.png"><link rel="icon" type="image/png" sizes="96x96" href="https://resources.jetbrains.com/storage/ui/favicons/apple-touch-icon-60x60.png"><link rel="icon" type="image/png" sizes="300x300" href="https://resources.jetbrains.com/storage/ui/favicons/apple-touch-icon-72x72.png"><link rel="icon" type="image/png" sizes="500x500" href="https://resources.jetbrains.com/storage/ui/favicons/apple-touch-icon-76x76.png"><meta name="image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- Open Graph --><meta property="og:title" content="Android source set layout | Kotlin Multiplatform"><meta property="og:description" content=""><meta property="og:image" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><meta property="og:site_name" content="Kotlin Multiplatform Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-android-layout.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@kotlin"><meta name="twitter:title" content="Android source set layout | Kotlin Multiplatform"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@kotlin"><meta name="twitter:image:src" content="https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png"><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-android-layout.html#webpage",
    "url": "https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-android-layout.html",
    "name": "Android source set layout | Kotlin Multiplatform",
    "description": "",
    "image": "https://resources.jetbrains.com/storage/products/jetbrains/img/meta/preview.png",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://www.jetbrains.com/help/kotlin-multiplatform-dev/#website",
    "url": "https://www.jetbrains.com/help/kotlin-multiplatform-dev/",
    "name": "Kotlin Multiplatform Help"
}</script><!-- End Schema.org --><meta name="msapplication-TileColor" content="#000000"/>
<meta name="msapplication-TileImage"
      content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/>
<meta name="msapplication-square70x70logo"
      content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/>
<meta name="msapplication-square150x150logo"
      content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/>
<meta name="msapplication-wide310x150logo"
      content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/>
<meta name="msapplication-square310x310logo"
      content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>
<script>document.cookie="wh_theme=light;expires="+(new Date(Date.now()+500000000).toUTCString())+"; path=/;";</script>
<style>
<!--slack icon-->
[data-test="footer-socials"] [data-test="button"][title*="Kotlin Multiplatform Development Feed"]{position:relative;}
[data-test="footer-socials"] [data-test="button"][title*="Kotlin Multiplatform Development Feed"] svg{visibility:hidden;}
[data-test="footer-socials"] [data-test="button"][title*="Kotlin Multiplatform Development Feed"]::before{
display:block;content:"";position:absolute;top:0;bottom:0;left:0;right:0;
background:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="%23fff"><path d="M9.586 6.601h1.9v-1.9a1.837 1.837 0 00-1.9-1.9 1.9 1.9 0 000 3.8zm1.9 7.6v4.7a1.837 1.837 0 01-1.9 1.9 1.9 1.9 0 01-1.9-1.9v-4.7a1.899 1.899 0 011.9-1.9 1.837 1.837 0 011.9 1.9zm-5.864 1.773a1.839 1.839 0 01-.737.127 1.9 1.9 0 010-3.8h1.9v1.9a1.839 1.839 0 01-1.163 1.773zm3.963-4.673h-4.7a1.9 1.9 0 010-3.8h4.7a1.838 1.838 0 011.9 1.9 1.9 1.9 0 01-1.9 1.9zm11.4-1.9a1.967 1.967 0 00-1.9-1.9 1.899 1.899 0 00-1.9 1.9v1.9h1.9a1.9 1.9 0 001.9-1.9zm-5.862 1.773a1.839 1.839 0 01-.738.127 1.9 1.9 0 01-1.9-1.9v-4.7a1.839 1.839 0 011.9-1.9 1.898 1.898 0 011.9 1.9v4.7a1.837 1.837 0 01-1.162 1.773zm-.738 9.628a1.839 1.839 0 001.9-1.9 1.9 1.9 0 00-1.9-1.9h-1.9v1.9a1.899 1.899 0 001.9 1.9zm4.7-4.7h-4.7a1.9 1.9 0 110-3.8h4.7a1.836 1.836 0 011.9 1.9 1.9 1.9 0 01-1.9 1.9z"/></svg>') no-repeat center;background-size:20px 20px;}
[data-test="footer-socials"]+.jb-footer__legal{flex-basis:100%;margin-top:8px;}

<!--Drop any switches and set default theme-->
.wh-header__switchers{display:none!important}
</style></head><body data-id="multiplatform-android-layout" data-main-title="Android source set layout" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Compatibility" data-edit-url="https://github.com/JetBrains/kotlin-multiplatform-dev-docs/edit/master/topics/development/multiplatform-android-layout.md"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Kotlin Multiplatform  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="multiplatform-android-layout" id="multiplatform-android-layout.md">Android source set layout</h1><p id="-22e5b2_2">The new Android source set layout was introduced in Kotlin 1.8.0 and became the default in 1.9.0. Follow this guide to understand the key differences between the deprecated and the new layouts, as well as how to migrate your projects.</p><aside class="prompt" data-type="tip" data-title="" id="-22e5b2_3"><p id="-22e5b2_10">You don't need to implement all the suggestions, only those that are applicable to your particular projects.</p></aside><section class="chapter"><h2 id="check-the-compatibility" data-toc="check-the-compatibility">Check the compatibility</h2><p id="-22e5b2_11">The new layout requires Android Gradle plugin 7.0 or later and is supported in Android Studio 2022.3 and later. Check your version of the Android Gradle plugin and upgrade if necessary.</p></section><section class="chapter"><h2 id="rename-kotlin-source-sets" data-toc="rename-kotlin-source-sets">Rename Kotlin source sets</h2><p id="-22e5b2_12">If applicable, rename the source sets in your project, following this pattern:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_13"><thead><tr class="ijRowHead" id="-22e5b2_16"><th id="-22e5b2_18"><p>Previous source set layout</p></th><th id="-22e5b2_19"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_17"><td id="-22e5b2_20"><p><code class="code" id="-22e5b2_22">targetName</code> + <code class="code" id="-22e5b2_23">AndroidSourceSet.name</code></p></td><td id="-22e5b2_21"><p><code class="code" id="-22e5b2_24">targetName</code> + <code class="code" id="-22e5b2_25">AndroidVariantType</code></p></td></tr></tbody></table></div><p id="-22e5b2_14"><code class="code" id="-22e5b2_26">{AndroidSourceSet.name}</code> maps to <code class="code" id="-22e5b2_27">{KotlinSourceSet.name}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_15"><thead><tr class="ijRowHead" id="-22e5b2_28"><th id="-22e5b2_32"></th><th id="-22e5b2_33"><p>Previous source set layout</p></th><th id="-22e5b2_34"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_29"><td id="-22e5b2_35"><p>main</p></td><td id="-22e5b2_36"><p>androidMain</p></td><td id="-22e5b2_37"><p>androidMain</p></td></tr><tr id="-22e5b2_30"><td id="-22e5b2_38"><p>test</p></td><td id="-22e5b2_39"><p>androidTest</p></td><td id="-22e5b2_40"><p>android<b id="-22e5b2_41">Unit</b>Test</p></td></tr><tr id="-22e5b2_31"><td id="-22e5b2_42"><p>androidTest</p></td><td id="-22e5b2_43"><p>android<b id="-22e5b2_45">Android</b>Test</p></td><td id="-22e5b2_44"><p>android<b id="-22e5b2_46">Instrumented</b>Test</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="move-source-files" data-toc="move-source-files">Move source files</h2><p id="-22e5b2_47">If applicable, move your source files to the new directories, following this pattern:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_48"><thead><tr class="ijRowHead" id="-22e5b2_51"><th id="-22e5b2_53"><p>Previous source set layout</p></th><th id="-22e5b2_54"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_52"><td id="-22e5b2_55"><p>The layout had additional <code class="code" id="-22e5b2_57">/kotlin</code> SourceDirectories</p></td><td id="-22e5b2_56"><p><code class="code" id="-22e5b2_58">src/{KotlinSourceSet.name}/kotlin</code></p></td></tr></tbody></table></div><p id="-22e5b2_49"><code class="code" id="-22e5b2_59">{AndroidSourceSet.name}</code> maps to <code class="code" id="-22e5b2_60">{SourceDirectories included}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_50"><thead><tr class="ijRowHead" id="-22e5b2_61"><th id="-22e5b2_65"></th><th id="-22e5b2_66"><p>Previous source set layout</p></th><th id="-22e5b2_67"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_62"><td id="-22e5b2_68"><p>main</p></td><td id="-22e5b2_69"><p>src/androidMain/kotlin</p><br><p> src/main/kotlin</p><br><p> src/main/java</p></td><td id="-22e5b2_70"><p>src/androidMain/kotlin</p><br><p> src/main/kotlin</p><br><p> src/main/java</p></td></tr><tr id="-22e5b2_63"><td id="-22e5b2_75"><p>test</p></td><td id="-22e5b2_76"><p>src/androidTest/kotlin</p><br><p> src/test/kotlin</p><br><p> src/test/java</p></td><td id="-22e5b2_77"><p>src/android<b id="-22e5b2_80">Unit</b>Test/kotlin</p><br><p> src/test/kotlin</p><br><p> src/test/java</p></td></tr><tr id="-22e5b2_64"><td id="-22e5b2_83"><p>androidTest</p></td><td id="-22e5b2_84"><p>src/android<b id="-22e5b2_86">Android</b>Test/kotlin</p><br><p> src/androidTest/java</p></td><td id="-22e5b2_85"><p>src/android<b id="-22e5b2_88">Instrumented</b>Test/kotlin</p><br><p> src/androidTest/java, <b id="-22e5b2_90">src/androidTest/kotlin</b></p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="move-the-androidmanifest-xml-file" data-toc="move-the-androidmanifest-xml-file">Move the AndroidManifest.xml file</h2><p id="-22e5b2_91">If you have the <code class="code" id="-22e5b2_95">AndroidManifest.xml</code> file in your project, move it to the new directory, following this pattern:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_92"><thead><tr class="ijRowHead" id="-22e5b2_96"><th id="-22e5b2_98"><p>Previous source set layout</p></th><th id="-22e5b2_99"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_97"><td id="-22e5b2_100"><p>src/{<b id="-22e5b2_102">Android</b>SourceSet.name}/AndroidManifest.xml</p></td><td id="-22e5b2_101"><p>src/{<b id="-22e5b2_103">Kotlin</b>SourceSet.name}/AndroidManifest.xml</p></td></tr></tbody></table></div><p id="-22e5b2_93"><code class="code" id="-22e5b2_104">{AndroidSourceSet.name}</code> maps to <code class="code" id="-22e5b2_105">{AndroidManifest.xml location}</code> as follows:</p><div class="table-wrapper"><table class="wide" id="-22e5b2_94"><thead><tr class="ijRowHead" id="-22e5b2_106"><th id="-22e5b2_109"></th><th id="-22e5b2_110"><p>Previous source set layout</p></th><th id="-22e5b2_111"><p>New source set layout</p></th></tr></thead><tbody><tr id="-22e5b2_107"><td id="-22e5b2_112"><p>main</p></td><td id="-22e5b2_113"><p>src/main/AndroidManifest.xml</p></td><td id="-22e5b2_114"><p>src/<b id="-22e5b2_115">android</b>Main/AndroidManifest.xml</p></td></tr><tr id="-22e5b2_108"><td id="-22e5b2_116"><p>debug</p></td><td id="-22e5b2_117"><p>src/debug/AndroidManifest.xml</p></td><td id="-22e5b2_118"><p>src/<b id="-22e5b2_119">android</b>Debug/AndroidManifest.xml</p></td></tr></tbody></table></div></section><section class="chapter"><h2 id="check-the-relationship-between-android-and-common-tests" data-toc="check-the-relationship-between-android-and-common-tests">Check the relationship between Android and common tests</h2><p id="-22e5b2_120">The new Android source set layout changes the relationship between Android-instrumented tests (renamed to <code class="code" id="-22e5b2_125">androidInstrumentedTest</code> in the new layout) and common tests.</p><p id="-22e5b2_121">Previously, the <code class="code" id="-22e5b2_126">dependsOn</code> relationship between <code class="code" id="-22e5b2_127">androidAndroidTest</code> and <code class="code" id="-22e5b2_128">commonTest</code> was the default. It meant the following:</p><ul class="list _bullet" id="-22e5b2_122"><li class="list__item" id="-22e5b2_129"><p>The code in <code class="code" id="-22e5b2_132">commonTest</code> was available in <code class="code" id="-22e5b2_133">androidAndroidTest</code>.</p></li><li class="list__item" id="-22e5b2_130"><p><code class="code" id="-22e5b2_134">expect</code> declarations in <code class="code" id="-22e5b2_135">commonTest</code> had to have corresponding <code class="code" id="-22e5b2_136">actual</code> implementations in <code class="code" id="-22e5b2_137">androidAndroidTest</code>.</p></li><li class="list__item" id="-22e5b2_131"><p>Tests declared in <code class="code" id="-22e5b2_138">commonTest</code> were also running as Android instrumented tests.</p></li></ul><p id="-22e5b2_123">In the new Android source set layout, the <code class="code" id="-22e5b2_139">dependsOn</code> relationship is not added by default. If you prefer the previous behavior, manually declare the following relationship in your <code class="code" id="-22e5b2_140">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
// ...
    sourceSets {
        val commonTest by getting
        val androidInstrumentedTest by getting {
            dependsOn(commonTest)
        }
    }
}
</div></section><section class="chapter"><h2 id="adjust-the-implementation-of-android-flavors" data-toc="adjust-the-implementation-of-android-flavors">Adjust the implementation of Android flavors</h2><p id="-22e5b2_141">Previously, the Kotlin Gradle plugin eagerly created source sets that corresponded to Android source sets containing <code class="code" id="-22e5b2_145">debug</code> and <code class="code" id="-22e5b2_146">release</code> build types or custom flavors like <code class="code" id="-22e5b2_147">demo</code> and <code class="code" id="-22e5b2_148">full</code>. It made the source sets accessible by using expressions like <code class="code" id="-22e5b2_149">val androidDebug by getting { ... }</code>.</p><p id="-22e5b2_142">The new Android source set layout makes use of Android's <a href="https://developer.android.com/reference/tools/gradle-api/8.0/com/android/build/api/variant/AndroidComponentsExtension#onVariants(com.android.build.api.variant.VariantSelector,kotlin.Function1)" id="-22e5b2_150" data-external="true" rel="noopener noreferrer"><code class="code" id="-22e5b2_152">onVariants</code></a> to create source sets. It makes such expressions invalid, leading to errors like <code class="code" id="-22e5b2_151">org.gradle.api.UnknownDomainObjectException: KotlinSourceSet with name 'androidDebug' not found</code>.</p><p id="-22e5b2_143">To work around that, use the new <code class="code" id="-22e5b2_153">invokeWhenCreated()</code> API in your <code class="code" id="-22e5b2_154">build.gradle.kts</code> file:</p><div class="code-block" data-lang="kotlin">
kotlin {
// ...
    @OptIn(ExperimentalKotlinGradlePluginApi::class)
    sourceSets.invokeWhenCreated(&quot;androidFreeDebug&quot;) {
// ...
    }
}
</div></section><div class="last-modified">Last modified: 16 May 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="multiplatform-compatibility-guide.html" class="navigation-links__prev">Compatibility guide for Kotlin Multiplatform</a><a href="multiplatform-plugin-releases.html" class="navigation-links__next">Kotlin Multiplatform IDE plugin releases</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b454/app.js"></script></body></html>