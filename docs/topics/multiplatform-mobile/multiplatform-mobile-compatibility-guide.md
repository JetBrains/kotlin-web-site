[//]: # (title: Compatibility guide for Kotlin Multiplatform Mobile)

This guide summarizes [incompatible changes](kotlin-evolution.md#incompatible-changes) you may encounter while
developing projects with Kotlin Multiplatform Mobile.

Mind the deprecation cycle of a specific change in relation to the Kotlin version you have in your projects. The current
Stable version of Kotlin is %kotlinVersion%.

## Auto-generated targets

**What's changed?**

Target accessors auto-generated by Gradle are no longer available inside the `kotlin.targets { }` block. Use
the `findByName("targetName")` method instead.

Note that such accessors are still available in the `kotlin.targets` case, for example, `kotlin.targets.linuxX64`.

**What's the best practice now?**

<table>
   <tr>
      <th>Before</th>
      <th>Now</th>
   </tr>
  <tr>
    <td>
        <code style="block"
              lang="Kotlin">
            kotlin {
                targets {
                    configure(['windows', 'linux')]) {
                    }
                }
            }
        </code>
    </td>
    <td>
        <code style="block"
              lang="Kotlin">
            kotlin {
                targets {
                    configure([findByName('windows'), findByName('linux')]) {
                    }
                }
            }
        </code>
    </td>
  </tr>
</table>

**When do the changes take effect?**

In Kotlin 1.7.20, an error is introduced when using targets accessors in the `kotlin.targets { }` block.

For more information, see the corresponding issue on [YouTrack](https://youtrack.jetbrains.com/issue/KT-47047).

## Gradle input and output compile tasks

**What's changed?**

Kotlin compile tasks no longer inherit the Gradle `AbstractCompile` task that has the `sourceCompatibility` and
`targetCompatibility` inputs, making them unavailable in Kotlin users' scripts.

Also, there are some other breaking changes in compile tasks you may encounter:

**What's the best practice now?**

| Before                                                              | Now                                                                                                            |
|---------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| The `SourceTask.stableSources` input is no longer available.        | Use the `sources` input instead. Also, the `setSource()` methods are still available.                          |
| The `sourceFilesExtensions` input was removed.                      | Compile tasks still implement the `PatternFilterable` interface. Use its methods for filtering Kotlin sources. |
| The `Gradle destinationDir: File` output was deprecated.            | Use the `destinationDirectory: DirectoryProperty` output instead.                                              |
| The `classpath` property of the `KotlinCompile` task is deprecated. | All compile tasks now use the `libraries` input for a list of libraries required for compilation.              |

**When do the changes take effect?**

In Kotlin 1.7.20, inputs are not available, the output is replaced, and the `classpath` property is deprecated.

For more information, see the corresponding issue on [YouTrack](https://youtrack.jetbrains.com/issue/KT-32805).

## New configuration names for dependencies on the compilation

**What's changed?**

Compilation configurations created by the Kotlin Multiplatform Gradle Plugin received new names.

A target in the Kotlin Multiplatform project has two default compilations, `main` and `test`. Each of these compilations
has its own default source set, for example, `jvmMain` and `jvmTest`. Previously the configuration names for the test
compilation and its default source set were the same, which might lead to a name clash resulting in issues when a
configuration marked with platform-specific attributes is included in another configuration.

Now compilation configurations have an extra `Compilation` postfix, while projects and plugins that use old hard-coded
configuration names no longer compile.

Configuration names for dependencies on the corresponding source set stay the same.

**What's the best practice now?**

<table>
   <tr>
      <th></th>
      <th>Before</th>
      <th>Now</th>
   </tr>
   <tr>
     <td rowspan="2" >Dependencies of the `jvmMain` compilation</td>
       <td>
        <code style="block"
          lang="Kotlin">
            <![CDATA[
            jvm<Scope>
            ]]>
        </code>
       </td>
     <td>
        <code style="block"
          lang="Kotlin">
            <![CDATA[
            jvmCompilation<Scope>
            ]]>
        </code>
     </td>
   </tr>
   <tr>
    <td>
      <code style="block"
        lang="Kotlin">
          dependencies {
              add("jvmImplementation", "foo.bar.baz:1.2.3")
          }
      </code>
    </td>
    <td>
      <code style="block"
        lang="Kotlin">
          dependencies {
              add"jvmCompilationImplementation", "foo.bar.baz:1.2.3")
          }
      </code>
    </td>
   </tr>
   <tr>
    <td>Dependencies of the <code>jvmMain</code> source set</td>
    <td colspan="2" align="center">
      <code style="block"
        lang="Kotlin">
          <![CDATA[
          jvmMain<Scope>
          ]]>
      </code>
    </td>
   </tr>
   <tr>
     <td>Dependencies of the <code>jvmTest</code> compilation</td>
     <td>
       <code style="block"
         lang="Kotlin">
           <![CDATA[
           jvmTest<Scope>
           ]]>
       </code>
     </td>
     <td>
       <code style="block"
         lang="Kotlin">
         <![CDATA[
         jvmTestCompilation<Scope>
         ]]>
       </code>
     </td>
   </tr>
   <tr>
     <td>Dependencies of the <code>jvmTest</code> source set</td>
     <td colspan="2" align="center">
       <code style="block"
       lang="Kotlin">
        <![CDATA[
        jvmTest<Scope>
        ]]>
       </code>
     </td>
   </tr>
</table>

The available scopes are `Api`, `Implementation`, `CompileOnly`, and `RuntimeOnly`.

**When do the changes take effect?**

In Kotlin 1.8.0, an error is introduced when using old configuration names in hard-coded strings.

For more information, see the corresponding issue on [YouTrack](https://youtrack.jetbrains.com/issue/KT-35916/).